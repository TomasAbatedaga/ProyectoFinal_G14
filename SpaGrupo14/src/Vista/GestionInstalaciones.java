/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JInternalFrame.java to edit this template
 */
package Vista;

import Estilo.EstiloVisual;
import Modelo.Instalacion;
import Persistencia.InstalacionData;
import javax.swing.JOptionPane;

/**
 *
 * @author jorge
 */
public class GestionInstalaciones extends javax.swing.JInternalFrame {

    /**
     * Creates new form GestionInstalaciones
     */
    public GestionInstalaciones() {
        initComponents();
        EstiloVisual.aplicarEstiloJDPanel(jDesktopPane1);
        EstiloVisual.aplicarEstiloBoton(btn_buscar);
        EstiloVisual.aplicarEstiloBoton(btn_agregar);
        EstiloVisual.aplicarEstiloBoton(btn_modificar);
        EstiloVisual.aplicarEstiloBoton(btn_limpiar);
        EstiloVisual.aplicarEstiloBoton(btn_eliminar);
        
    }
      private void limpiarCampos() {
//  Vaciar los campos de texto
        txt_codigo.setText("");
        txt_nombre.setText("");
        textArea_detalle_uso.setText("");
        txt_precio.setText("");
        chk_estado.setSelected(false);
      }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jDesktopPane1 = new javax.swing.JDesktopPane();
        lbl_titulo = new javax.swing.JLabel();
        lbl_nombre = new javax.swing.JLabel();
        lbl_detalle_uso = new javax.swing.JLabel();
        lbl_precio = new javax.swing.JLabel();
        txt_nombre = new javax.swing.JTextField();
        txt_precio = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        textArea_detalle_uso = new javax.swing.JTextArea();
        lbl_estado = new javax.swing.JLabel();
        chk_estado = new javax.swing.JCheckBox();
        btn_agregar = new javax.swing.JButton();
        btn_modificar = new javax.swing.JButton();
        btn_eliminar = new javax.swing.JButton();
        btn_limpiar = new javax.swing.JButton();
        btn_buscar = new javax.swing.JButton();
        lbl_codigo = new javax.swing.JLabel();
        txt_codigo = new javax.swing.JTextField();

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);

        lbl_titulo.setFont(new java.awt.Font("SimSun", 1, 24)); // NOI18N
        lbl_titulo.setText("Gestion Instalacion");

        lbl_nombre.setText("Nombre:");

        lbl_detalle_uso.setText("Detalle de uso:");

        lbl_precio.setText("Precio 30 Min:");

        txt_precio.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txt_precioActionPerformed(evt);
            }
        });

        textArea_detalle_uso.setColumns(20);
        textArea_detalle_uso.setRows(5);
        jScrollPane1.setViewportView(textArea_detalle_uso);

        lbl_estado.setText("Estado:");

        btn_agregar.setText("Agregar");
        btn_agregar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_agregarActionPerformed(evt);
            }
        });

        btn_modificar.setText("Modificar");
        btn_modificar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_modificarActionPerformed(evt);
            }
        });

        btn_eliminar.setText("Eliminar");
        btn_eliminar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_eliminarActionPerformed(evt);
            }
        });

        btn_limpiar.setText("Limpiar");
        btn_limpiar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_limpiarActionPerformed(evt);
            }
        });

        btn_buscar.setText("Buscar");
        btn_buscar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_buscarActionPerformed(evt);
            }
        });

        lbl_codigo.setText("Codigo:");

        jDesktopPane1.setLayer(lbl_titulo, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(lbl_nombre, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(lbl_detalle_uso, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(lbl_precio, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(txt_nombre, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(txt_precio, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(jScrollPane1, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(lbl_estado, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(chk_estado, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(btn_agregar, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(btn_modificar, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(btn_eliminar, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(btn_limpiar, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(btn_buscar, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(lbl_codigo, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jDesktopPane1.setLayer(txt_codigo, javax.swing.JLayeredPane.DEFAULT_LAYER);

        javax.swing.GroupLayout jDesktopPane1Layout = new javax.swing.GroupLayout(jDesktopPane1);
        jDesktopPane1.setLayout(jDesktopPane1Layout);
        jDesktopPane1Layout.setHorizontalGroup(
            jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jDesktopPane1Layout.createSequentialGroup()
                .addGap(49, 49, 49)
                .addGroup(jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jDesktopPane1Layout.createSequentialGroup()
                        .addGroup(jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(lbl_titulo)
                            .addGroup(jDesktopPane1Layout.createSequentialGroup()
                                .addGroup(jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(lbl_detalle_uso)
                                    .addComponent(lbl_estado)
                                    .addComponent(lbl_precio)
                                    .addComponent(lbl_codigo)
                                    .addComponent(lbl_nombre)
                                    .addComponent(btn_agregar))
                                .addGap(27, 27, 27)
                                .addGroup(jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addGroup(jDesktopPane1Layout.createSequentialGroup()
                                        .addComponent(txt_codigo, javax.swing.GroupLayout.PREFERRED_SIZE, 177, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(btn_buscar))
                                    .addComponent(txt_precio, javax.swing.GroupLayout.PREFERRED_SIZE, 270, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(txt_nombre, javax.swing.GroupLayout.PREFERRED_SIZE, 270, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 270, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(chk_estado))))
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jDesktopPane1Layout.createSequentialGroup()
                        .addGap(124, 124, 124)
                        .addComponent(btn_modificar)
                        .addGap(51, 51, 51)
                        .addComponent(btn_limpiar)
                        .addGap(27, 27, 27)
                        .addComponent(btn_eliminar)
                        .addGap(136, 136, 136))))
        );
        jDesktopPane1Layout.setVerticalGroup(
            jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jDesktopPane1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lbl_titulo)
                .addGap(36, 36, 36)
                .addGroup(jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbl_nombre)
                    .addComponent(txt_nombre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(lbl_detalle_uso)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(36, 36, 36)
                .addGroup(jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbl_codigo)
                    .addComponent(txt_codigo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btn_buscar))
                .addGap(31, 31, 31)
                .addGroup(jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txt_precio, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lbl_precio))
                .addGap(31, 31, 31)
                .addGroup(jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(chk_estado)
                    .addComponent(lbl_estado))
                .addGap(27, 27, 27)
                .addGroup(jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btn_agregar)
                    .addComponent(btn_modificar)
                    .addComponent(btn_limpiar)
                    .addComponent(btn_eliminar))
                .addContainerGap(57, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jDesktopPane1)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jDesktopPane1)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void txt_precioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txt_precioActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txt_precioActionPerformed

    private void btn_agregarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_agregarActionPerformed
        // TODO add your handling code here:
//            try{
//        InstalacionData instalacionData = new InstalacionData();
//        String nombre = txt_nombre.getText();
//        String detalleUso =  textArea_detalle_uso.getText();
//        double precio = Double.parseDouble(txt_precio.getText());
//        boolean estado = chk_estado.isSelected();
//        Instalacion instalacion = new Instalacion (nombre, detalleUso, precio, estado);
//        instalacionData.guardarIntalacion(instalacion);
//        } catch (NumberFormatException e) {
//            JOptionPane.showMessageDialog(this, "Ingrese valores correctos en el campo precio");
//        }

try {
           String nombre = txt_nombre.getText();
           String detalleUso =  textArea_detalle_uso.getText();
           
            if (nombre.isEmpty()) {
                JOptionPane.showMessageDialog(this, "El campo Nombre no puede estar vacio.");
                return;
            }
           
           
           double precio = Double.parseDouble(txt_precio.getText());
           boolean estado = chk_estado.isSelected();

            InstalacionData instalacionData = new InstalacionData();
            Instalacion instalacion = new Instalacion (nombre, detalleUso, precio, estado);
            instalacionData.guardarIntalacion(instalacion);

            JOptionPane.showMessageDialog(this, "La Instalacion se agrego exitosamente.");
            //limpiaCampos
            limpiarCampos();

        } catch (NumberFormatException e) {
            // Este error salta si el DNI o la Edad tienen letras o simbolos
            JOptionPane.showMessageDialog(this, "Error de formato: Verifique que el Precio sea un numero.");
        } catch (Exception e) {
            // Captura errores inesperados
            JOptionPane.showMessageDialog(this, "Ocurrio un error al guardar: " + e.getMessage());
        }
    }//GEN-LAST:event_btn_agregarActionPerformed

    private void btn_modificarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_modificarActionPerformed
        // TODO add your handling code here:
//          try {
//            InstalacionData instalacionData = new InstalacionData();
//             int cod_instalacion = Integer.parseInt(txt_codigo.getText());
//            if (instalacionData.buscarInstalacion(cod_instalacion) != null) {
//                 String nombre = txt_nombre.getText();
//                 String detalle_uso =  textArea_detalle_uso.getText();
//                 double precio = Double.parseDouble(txt_precio.getText());
//                 boolean estado = chk_estado.isSelected();
//                 Instalacion instalacion = new Instalacion( cod_instalacion,nombre, detalle_uso, precio, estado);
//                 instalacionData.modificarInstalacion(instalacion);
//            } else {
//                JOptionPane.showMessageDialog(this, "No se encuentra el Codigo de Instalacion ingresado");
//            }
//        } catch (NumberFormatException e) {
//            JOptionPane.showMessageDialog(this, "Ingrese un numero valido en el campo Codigo de Instalacion");
//        }
        
try {   
            InstalacionData instalacionData = new InstalacionData();

            // Validar
            if (txt_codigo.getText().trim().isEmpty()) {
                JOptionPane.showMessageDialog(this, "El campo Codigo de la Instalacion no puede estar vacio.");
                return;
            }

           int cod_instalacion = Integer.parseInt(txt_codigo.getText());;
            Instalacion instalacionOriginal = instalacionData.buscarInstalacion(cod_instalacion);
            if (instalacionOriginal == null) {
                JOptionPane.showMessageDialog(this, "No existe ninguna Instalacion con ese codigo ingresado");
                return;
            }

            // Validar demas Campos
                 String nombre = txt_nombre.getText();
                 String detalle_uso =  textArea_detalle_uso.getText();
                 String precioText = txt_precio.getText();
                 
            

            // Validar Vacios
            if (nombre.isEmpty() || precioText.isEmpty()) {
                JOptionPane.showMessageDialog(this, "El Nombre y el Precio son obligatorios.");
                return;
            }
            
            double precio = Double.parseDouble(txt_precio.getText());

            //Confirmaciones
            int confirmacion = JOptionPane.showConfirmDialog(this,
                    "¿Esta seguro de modificar los datos de la Instalacion " + nombre + "?",
                    "Confirmar Modificacion",
                    JOptionPane.YES_NO_OPTION);

            if (confirmacion == JOptionPane.YES_OPTION) {
                //Actualiza
                boolean estado = chk_estado.isSelected();
                Instalacion instalacion = new Instalacion( cod_instalacion,nombre, detalle_uso, precio, estado);

                Instalacion instalacionModificado = new Instalacion(cod_instalacion,nombre, detalle_uso, precio, estado);

                //Traer ID del cliente BD
                instalacionModificado.setCodInstal(instalacionOriginal.getCodInstal());

                instalacionData.modificarInstalacion(instalacionModificado);
                JOptionPane.showMessageDialog(this, "Instalacion modificada.");
                limpiarCampos();
            }

        } catch (NumberFormatException e) {
            // atrapa Errores Edad y DNI
            JOptionPane.showMessageDialog(this, "Error de formato: Verifique que el Precio y el Codigo contengan solo numeros enteros.");
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Ocurrio un error inesperado: " + e.getMessage());
        }
    }//GEN-LAST:event_btn_modificarActionPerformed

    private void btn_limpiarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_limpiarActionPerformed
        // TODO add your handling code here:
     limpiarCampos();
    }//GEN-LAST:event_btn_limpiarActionPerformed

    private void btn_eliminarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_eliminarActionPerformed
//        // TODO add your handling code here:
//        try {
//            InstalacionData instalacionData = new InstalacionData();
//            int cod_instalacion = Integer.parseInt(txt_codigo.getText());
//            if (instalacionData.buscarInstalacion(cod_instalacion) != null) {
//                instalacionData.eliminarInstalacion(cod_instalacion);
//            } else {
//                JOptionPane.showMessageDialog(this, "No se encuentra el Nro de Instalacion ingresado");
//            }
//        } catch (NumberFormatException e) {
//            JOptionPane.showMessageDialog(this, "Ingrese un numero valido en el campo de Instalacion");
//        }

try {
            if (txt_codigo.getText().trim().isEmpty()) {
                JOptionPane.showMessageDialog(this, "Debe ingresar un Codigo de Instalacion para borrar.");
                return;
            }

             int cod_instalacion = Integer.parseInt(txt_codigo.getText());
            InstalacionData instalacionData = new InstalacionData();

            Instalacion instalacionEncontrado = instalacionData.buscarInstalacion(cod_instalacion);

            if (instalacionEncontrado != null) {

                int respuesta = JOptionPane.showConfirmDialog(this,
                        "¿Esta seguro que desea eliminar La Instalacion " + instalacionEncontrado.getNombre() + "?",
                        "Confirmar",
                        JOptionPane.YES_NO_OPTION,
                        JOptionPane.WARNING_MESSAGE);

                if (respuesta == JOptionPane.YES_OPTION) {
                    instalacionData.eliminarInstalacion(cod_instalacion);

                    JOptionPane.showMessageDialog(this, "Instalacion eliminada.");
                    limpiarCampos();
                }

            } else {
                JOptionPane.showMessageDialog(this, "No se encuentra una Instalacion con ese codigo.");
            }

        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Ingrese un num valido en el campo Codigo de Instalacion.");
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Error al eliminar: " + e.getMessage());
        }
    }//GEN-LAST:event_btn_eliminarActionPerformed

    private void btn_buscarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_buscarActionPerformed
        // TODO add your handling code here:
//        try {
//            InstalacionData instalacionData = new InstalacionData();
//            int cod_Instalacion = Integer.parseInt(txt_codigo.getText());
//            Instalacion instalacion = instalacionData.buscarInstalacion(cod_Instalacion);
//            if (instalacion != null) {
//                 txt_nombre.setText(instalacion.getNombre());
//                 textArea_detalle_uso.setText(instalacion.getDetalleUso());
//                 txt_precio.setText(String.valueOf(instalacion.getPrecio()));
//                 chk_estado.setSelected(instalacion.isEstado());
//            } else {
//                JOptionPane.showMessageDialog(this, "No se encuentra el codigo de la Instalacion ingresado");
//            }
//        } catch (NumberFormatException e) {
//            JOptionPane.showMessageDialog(this, "Ingrese un numero valido en el campo Codigo del Instalacion");
//        }

try {
            InstalacionData instalacionData = new InstalacionData();
            int cod_Instalacion = Integer.parseInt(txt_codigo.getText());
           Instalacion instalacion = instalacionData.buscarInstalacion(cod_Instalacion);
            if (instalacion != null) {
                txt_nombre.setText(instalacion.getNombre());
                 textArea_detalle_uso.setText(instalacion.getDetalleUso());
                 txt_precio.setText(String.valueOf(instalacion.getPrecio()));
                 chk_estado.setSelected(instalacion.isEstado());

            if (!instalacion.isEstado()) {
            JOptionPane.showMessageDialog(this, "Esta Instalacion figura como Inactivo/Dado de baja.");
        }    
            } else {
                JOptionPane.showMessageDialog(this, "No se encuentra la Instalacion ingresado: "+ cod_Instalacion);
                limpiarCampos();
                //Mantener el Campo DNI Escrito
                txt_codigo.setText(String.valueOf(cod_Instalacion));
            }
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Ingrese un num Valido para Buscar Instalaciones");
        txt_codigo.setText("");
        }catch (Exception e) {
    JOptionPane.showMessageDialog(this, "Error al buscar: " + e.getMessage());
}
        
    }//GEN-LAST:event_btn_buscarActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btn_agregar;
    private javax.swing.JButton btn_buscar;
    private javax.swing.JButton btn_eliminar;
    private javax.swing.JButton btn_limpiar;
    private javax.swing.JButton btn_modificar;
    private javax.swing.JCheckBox chk_estado;
    private javax.swing.JDesktopPane jDesktopPane1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lbl_codigo;
    private javax.swing.JLabel lbl_detalle_uso;
    private javax.swing.JLabel lbl_estado;
    private javax.swing.JLabel lbl_nombre;
    private javax.swing.JLabel lbl_precio;
    private javax.swing.JLabel lbl_titulo;
    private javax.swing.JTextArea textArea_detalle_uso;
    private javax.swing.JTextField txt_codigo;
    private javax.swing.JTextField txt_nombre;
    private javax.swing.JTextField txt_precio;
    // End of variables declaration//GEN-END:variables
}
